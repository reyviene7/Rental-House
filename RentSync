#!/bin/bash

case $1 in
  client)
    cd client
    ;;

  mobile)
    cd mobile
    ;;

  server)
    cd server
    ;;

  ws)
    cd websocket
    ;;

  *)
    echo "‚ùå Invalid module. Use: client | mobile | server"
    exit 1
    ;;
esac

module="$1"
case $2 in
  setup)
    if [ $module == "mobile" ]
    then
      echo "üì± Setting up Expo Mobile App..."
      cp .env.local.example .env.local
      npm install -g eas-cli
      npm install
      echo "‚úÖ Mobile setup complete. Login to Expo if needed:"
      npx expo login
    elif [ $module == "server" ]
    then
      echo "üñ•Ô∏è Setting up NestJS Server..."
      cp .env.example .env
      npm install -g @nestjs/cli
      npm install
      echo "‚úÖ Server setup complete."
    elif [ $module == "client" ]
    then
      echo "üíª Setting up Web Client..."
      cp .env.example .env.local
      npm install
      echo "‚úÖ Client setup complete."
    fi
    ;;

  run)
    if [ $module == "mobile" ]
    then
      npx expo start
    elif [ $module == "server" ]
    then
      npm run start:dev
    elif [ $module == "client" ]
    then
      npm run dev
    fi
    ;;

  build)
    if [ $module == "server" ]
    then
      npm run build
    elif [ $module == "mobile" ]
    then
      eas build --profile production --platform android
    elif [ $module == "client" ]
    then
      npm run build
    fi
    ;;

  *)
    echo "‚ùå Invalid command. Use: setup | run | build"
    exit 1
    ;;
esac
